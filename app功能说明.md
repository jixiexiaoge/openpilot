# CP搭子 - 应用功能详细说明

## 📱 应用简介

**CP搭子**（CPlink）是一款专为 Comma3 设备设计的 Android 导航数据桥接应用。它是**现阶段唯一一款可以读取高德地图导航数据并实时发送给 Comma3 设备，实现 CarrotPilot 辅助导航驾驶的应用**。

### 🎯 核心价值

这款应用解决了 Comma3 设备无法直接使用高德地图导航数据的痛点，通过手机作为"数据桥梁"，让您的 Comma3 设备能够获得：
- ✅ 高德地图的实时导航路线
- ✅ 区间限速提醒
- ✅ 摄像头限速预警
- ✅ 转弯导航指引
- ✅ GPS 位置信息
- ✅ 道路限速数据

---

## 🌟 主要功能详解

### 1. 📡 高德地图数据接收功能

**功能描述：**
应用可以自动接收高德地图发送的实时导航数据广播，无需您手动操作。

**支持的导航数据类型：**

#### 1.1 GPS 位置信息
- **接收内容**：车辆的实时经纬度坐标、行驶方向、GPS 精度
- **更新频率**：实时更新（每秒多次）
- **用途**：为 Comma3 设备提供准确的车辆位置信息，用于路径规划和导航显示

#### 1.2 道路限速信息
- **接收内容**：当前道路的限速值（如 60km/h、80km/h、120km/h）
- **更新频率**：道路变化时自动更新
- **用途**：Comma3 可以根据道路限速自动调整巡航速度，避免超速

#### 1.3 摄像头和测速信息（SDI 数据）
应用支持接收并转换**多种类型的摄像头和限速信息**：

**支持的摄像头类型（65 种）：**
- 🚦 **测速摄像头**：固定测速点，限速提醒
- 🔴 **闯红灯拍照**：路口闯红灯监测
- 📸 **区间测速**：区间起点、终点、当前区间状态
- 🚓 **流动测速**：移动式超速监测
- ⚠️ **减速带提醒**：前方减速带预警
- 🏥 **学校区域**：学校路段限速提醒
- 🚧 **隧道区间**：隧道内限速提醒
- 🛣️ **应急车道抓拍**：应急车道违规监测
- 🚌 **公交专用道摄像头**：公交车道监测
- 📍 **违停拍照**：违停监测点
- 🚦 **交通灯摄像头**：红绿灯状态监测
- 以及其他 55+ 种摄像头类型...

**数据包含信息：**
- 摄像头类型（测速、闯红灯、区间测速等）
- 限速值（如果有）
- 距离（到摄像头的距离，单位：米）
- 区间状态（区间测速的起点、中段、终点）

#### 1.4 转弯导航信息（TBT 数据）
- **接收内容**：
  - 下一个转弯的类型（左转、右转、直行、掉头等）
  - 到转弯点的距离（米）
  - 转弯指示文本（如"前方 200 米左转"）
  - 道路名称（当前道路、下一条道路）
  - 下一转弯信息（连续转弯的第二个转弯）
- **用途**：Comma3 可以在 HUD 上显示转弯提示，并在转弯前自动减速

#### 1.5 目的地信息
- **接收内容**：
  - 目的地名称（如"XX 商场"）
  - 目的地地址
  - 目的地经纬度坐标
  - 剩余距离和时间
- **用途**：Comma3 可以显示目的地信息，并用于路径规划

#### 1.6 交通灯状态（新增）
- **接收内容**：
  - 红绿灯状态（红灯、绿灯、黄灯）
  - 到红绿灯的距离
  - 绿灯剩余秒数（倒计时）
  - 红绿灯方向（直行、左转、右转等）
- **用途**：Comma3 可以在接近红绿灯时自动减速，提高安全性

---

### 2. 🔄 数据格式转换功能

**为什么需要转换？**
高德地图使用的数据格式与 Comma3 设备能够理解的格式不同。应用会自动完成这个转换过程。

**转换内容：**

#### 2.1 摄像头类型映射
- 将高德地图的摄像头类型代码（0-65）转换为 Comma3 能理解的 SDI 类型代码
- 例如：高德的"区间测速开始"（代码 8）→ Comma3 的 SDI 类型 2

#### 2.2 坐标系转换
- 确保 GPS 坐标数据格式符合 Comma3 的要求
- 处理坐标精度和格式转换

#### 2.3 速度单位转换
- 将速度数据统一为 Comma3 需要的单位（km/h）
- 处理限速数据的格式

#### 2.4 导航指令转换
- 将高德地图的转弯图标代码转换为 Comma3 的转弯类型代码
- 确保转弯提示在 Comma3 上正确显示

---

### 3. 🌐 WiFi 网络通信功能

**连接方式：**
应用通过 WiFi 网络与 Comma3 设备进行数据通信。

#### 3.1 自动设备发现
- **工作原理**：
  1. 应用启动后自动监听端口 7705，等待 Comma3 设备广播
  2. Comma3 设备会定期发送设备信息（IP 地址、端口号等）
  3. 应用收到广播后自动识别设备并建立连接
- **优势**：无需手动输入 IP 地址，即插即用

#### 3.2 实时数据发送
- **发送协议**：UDP 协议（适合实时数据）
- **发送频率**：每 200 毫秒发送一次（约每秒 5 次）
- **发送端口**：7706（数据端口）
- **数据格式**：JSON 格式的 CarrotMan 协议数据包

#### 3.3 连接状态监控
- **实时显示**：应用界面会显示连接状态
  - 🔍 "搜索设备中..."：正在寻找 Comma3 设备
  - ✅ "已连接"：成功连接到设备
  - ❌ "未连接"：未找到设备或连接断开
- **自动重连**：连接断开后会自动尝试重新连接

#### 3.4 网络质量监测
- **功能**：监控数据包发送成功率
- **错误处理**：网络错误时自动重试，智能恢复连接

---

### 4. 📍 GPS 定位功能

#### 4.1 高精度 GPS 获取
- **数据源**：优先使用高德地图提供的导航 GPS 坐标
- **后备方案**：如果高德 GPS 不可用，自动切换到手机 GPS
- **精度**：提供 GPS 精度信息（米）

#### 4.2 位置信息更新
- **更新频率**：实时更新（与高德地图导航同步）
- **包含信息**：
  - 经纬度坐标
  - 行驶方向（角度）
  - 当前速度
  - GPS 精度

---

### 5. 🎮 用户界面功能

#### 5.1 主界面显示
- **连接状态**：实时显示与 Comma3 设备的连接状态
- **设备信息**：显示已连接的设备 IP 地址和端口
- **数据统计**：显示已发送的数据包数量

#### 5.2 实时数据查看
- **导航状态**：显示是否正在导航
- **当前位置**：显示当前 GPS 坐标
- **道路信息**：显示当前道路名称
- **限速信息**：显示当前道路限速
- **转弯信息**：显示下一个转弯的详细信息
- **摄像头信息**：显示前方摄像头类型和距离

#### 5.3 帮助和设置
- **帮助页面**：详细的使用说明和常见问题
- **权限管理**：查看和管理应用权限
- **网络设置**：查看网络连接详情

---

### 6. 🔒 权限管理功能

应用需要以下权限才能正常工作：

#### 6.1 必需权限
- **位置权限**（精确位置和粗略位置）
  - 用途：获取 GPS 坐标，用于导航
  - 必须授予，否则无法工作

- **网络权限**（互联网和网络状态）
  - 用途：与 Comma3 设备通信
  - 必须授予，否则无法发送数据

#### 6.2 可选权限
- **后台位置权限**（Android 10+）
  - 用途：应用在后台时继续获取位置信息
  - 建议授予，以获得最佳体验

- **通知权限**（Android 13+）
  - 用途：显示连接状态通知
  - 可选，不影响核心功能

---

### 7. 🔄 后台运行功能

#### 7.1 前台服务
- **功能**：应用可以在后台持续运行
- **优势**：即使应用界面不可见，数据收发也不会中断
- **显示**：通知栏会显示运行状态

#### 7.2 自动重启
- **功能**：应用可以监听高德地图广播，即使应用未启动
- **优势**：收到高德地图导航数据时自动启动处理

---

## 📱 界面功能详解

### 主界面（主页）

主界面是应用的核心操作界面，包含以下功能区域：

#### 1. 顶部区域：Comma3 实时数据表格

**位置**：屏幕最顶部  
**功能**：显示从 Comma3 设备接收到的实时数据

**显示内容**：
- **导航状态**：显示是否正在导航
- **道路类型**：当前道路类型（高速/国道/省道等）
- **GPS 坐标**：车辆当前位置
- **速度信息**：当前车速、巡航速度
- **转弯信息**：下一个转弯的类型和距离
- **限速信息**：道路限速、摄像头限速
- **交通灯状态**：红绿灯状态和倒计时

**操作**：
- **点击标题栏**：展开/折叠数据表格（默认折叠，节省屏幕空间）

---

#### 2. 中间区域：自检查状态显示

**功能**：显示应用的初始化进度和系统状态

**显示内容**：
- **当前检查项**：正在进行的系统检查（仅在未完成时显示）
  - 显示检查项目名称（如"权限检查"、"网络连接"等）
  - 显示检查进度消息
  - 带有进度指示器

- **已完成项目列表**（初始化完成后自动显示 3 秒后隐藏）：
  - ✅ 权限检查
  - ✅ 网络初始化
  - ✅ GPS 定位
  - ✅ 系统信息（显示设备 ID 和用户类型）

---

#### 3. 底部控制区域：车辆控制按钮

**位置**：屏幕底部  
**布局**：5 个按钮横向排列

##### 🔵 左侧速度圆环（蓝色）

**外观**：
- 蓝色圆形速度指示器
- 中央显示数字（巡航设定速度，单位：km/h）
- 外围蓝色圆环

**功能**：
- **点击**：启动模拟导航功能
  - 使用当前 GPS 位置作为起点
  - 自动设置目的地（如上海东方明珠）
  - 向高德地图发送模拟导航指令
  - 用于测试导航功能

**使用场景**：
- 测试导航功能是否正常
- 调试数据收发功能
- 演示导航效果

---

##### 🏠 回家按钮（金色）

**外观**：
- 金色背景的圆形按钮
- 显示 🏠 图标

**功能**：
- **点击**：一键启动回家导航
  - 自动向高德地图发送回家指令
  - 高德地图会自动开始导航回家
  - 前提：需要在"我的"页面设置家庭地址

**使用场景**：
- 下班回家时快速启动导航
- 一键开始回家路线

---

##### 🚀 高阶按钮（橙色）

**外观**：
- 橙色背景的按钮
- 显示"高阶"文字

**功能**：
- **点击**：打开高阶功能弹窗（3x3 九宫格）
- **权限要求**：仅限**赞助者（用户类型 3）**或**铁粉（用户类型 4）**使用
- **权限不足时**：显示提示"需要赞助者权限"

**使用场景**：
- 高级车辆控制功能
- 速度调整、变道控制等

---

##### 🏢 公司按钮（橙色）

**外观**：
- 橙色背景的圆形按钮
- 显示 🏢 图标

**功能**：
- **点击**：一键启动到公司导航
  - 自动向高德地图发送到公司指令
  - 高德地图会自动开始导航到公司
  - 前提：需要在"我的"页面设置公司地址

**使用场景**：
- 上班时快速启动导航
- 一键开始到公司路线

---

##### 🟢 右侧速度圆环（绿色）

**外观**：
- 绿色圆形速度指示器
- 中央显示数字（车辆当前巡航速度，单位：km/h）
- 外围绿色圆环

**功能**：
- **点击**：启动高德地图应用
  - 直接打开高德地图
  - 方便快速设置目的地并开始导航

**使用场景**：
- 快速打开导航应用
- 设置目的地

---

### 高阶功能弹窗（九宫格）

**打开方式**：点击主页的"高阶"按钮（需要权限）

**布局**：3x3 九宫格按钮排列

---

#### 第一行

##### 1 号按钮（占位）
- **功能**：提示功能已移至主页蓝色速度圆环
- **颜色**：灰蓝色（未分配功能）

---

##### 2 号按钮：加速（绿色）

**外观**：
- 绿色背景
- 显示"加速"文字

**功能**：
- **点击**：增加巡航速度 10km/h
- **逻辑**：
  - 基于当前巡航速度（从 Comma3 设备获取）
  - 新速度 = 当前速度 + 10km/h
  - 最大限制：150km/h
  - 如果当前速度为 0，则设置为 50km/h

**使用场景**：
- 在高速公路上需要提速
- 快速调整巡航速度

---

##### 3 号按钮（占位）
- **功能**：提示点击弹窗外部区域关闭
- **颜色**：灰蓝色

---

#### 第二行

##### 4 号按钮：左变道（蓝色）

**外观**：
- 蓝色背景
- 显示"左变道"文字

**功能**：
- **点击**：发送左变道指令给 Comma3
- **用途**：在 CarrotPilot 系统支持下，触发车辆向左变道

**使用场景**：
- 需要在左侧车道行驶
- 超车时向左变道

---

##### 5 号按钮：智能控速（动态颜色）

**外观**：
- 颜色会根据当前模式变化：
  - **绿色**：智能控速模式
  - **蓝色**：原车巡航模式
  - **橙色**：弯道减速模式
- 显示当前模式名称（两行文字）

**功能**：
- **点击**：循环切换三种速度控制模式
- **三种模式**：
  1. **智能控速模式**（绿色）：
     - 根据导航数据和限速自动调整速度
     - 转弯时自动减速
     - 接近限速点时自动减速
  
  2. **原车巡航模式**（蓝色）：
     - 使用车辆原厂的巡航控制
     - 不受导航数据影响
  
  3. **弯道减速模式**（橙色）：
     - 仅在弯道时自动减速
     - 直道保持设定速度

**状态显示**：
- 按钮颜色反映当前模式
- 按钮文字显示模式名称
- 切换时显示"切换中..."（灰色）

**使用场景**：
- 根据驾驶需求选择不同的速度控制策略
- 高速公路用原车巡航，城市道路用智能控速

---

##### 6 号按钮：右变道（蓝色）

**外观**：
- 蓝色背景
- 显示"右变道"文字

**功能**：
- **点击**：发送右变道指令给 Comma3
- **用途**：在 CarrotPilot 系统支持下，触发车辆向右变道

**使用场景**：
- 需要在右侧车道行驶
- 准备下高速或转弯

---

#### 第三行

##### 7 号按钮：设置限速（紫色/灰色）

**外观**：
- **有限速时**：紫色背景，显示"XX限速"（如"80限速"）
- **无限速时**：灰色背景，显示"设置限速"，按钮禁用

**功能**：
- **点击**：将当前道路限速值设为巡航速度
- **前提**：需要从高德地图获取到道路限速信息
- **逻辑**：
  - 实时从高德地图获取当前道路限速
  - 点击后将限速值发送给 Comma3 作为新的巡航速度
  - 如果无限速信息，按钮不可用

**使用场景**：
- 快速将巡航速度设置为道路限速
- 避免超速行驶

---

##### 8 号按钮：减速（红色）

**外观**：
- 红色背景
- 显示"减速"文字

**功能**：
- **点击**：减少巡航速度 10km/h
- **逻辑**：
  - 基于当前巡航速度（从 Comma3 设备获取）
  - 新速度 = 当前速度 - 10km/h
  - 最小限制：20km/h
  - 如果当前速度已经 ≤ 20km/h，则显示提示"已是最低速度"

**使用场景**：
- 需要降低巡航速度
- 进入限速较低的路段

---

##### 9 号按钮：启用路径（绿色/灰色）

**外观**：
- **OpenpPilot 激活时**：绿色背景，显示"启用路径"
- **OpenpPilot 未激活时**：灰色背景，按钮禁用

**功能**：
- **点击**：手动发送导航确认给 Comma3
- **前提**：
  - OpenpPilot 系统必须已激活（active = true）
  - 高德地图必须正在导航
- **用途**：
  - 让 Comma3 开始跟随导航路线行驶
  - 启用自动转弯、自动变道等功能

**状态提示**：
- 如果 OpenpPilot 未激活，点击时显示提示："OpenpPilot未激活，请先启动车辆系统"

**使用场景**：
- 导航开始后，手动激活路径跟随功能
- 在特定路段需要启用导航辅助时

---

### 底部导航栏

**位置**：屏幕最底部  
**功能**：在不同功能页面之间切换

#### 🏠 主页
- **图标**：房子图标
- **功能**：切换到主界面（车辆控制界面）

#### ❓ 帮助
- **图标**：信息图标
- **功能**：查看帮助文档和使用说明
- **内容**：
  - 常见问题（FAQ）
  - 使用教程
  - 视频教程（如可用）

#### 👤 我的
- **图标**：用户图标
- **功能**：查看和管理用户信息
- **内容**：
  - 用户信息（设备 ID、用户类型等）
  - 使用统计（使用次数、时长、距离）
  - 用户信息编辑
  - 赞助二维码

#### ⚙️ 数据（仅铁粉用户可见）
- **图标**：设置图标
- **权限**：仅**铁粉用户（用户类型 4）**可见
- **功能**：查看详细的实时数据和调试信息
- **内容**：
  - 网络连接状态
  - 高德地图广播接收状态
  - Comma3 数据接收状态
  - 实时数据表格（所有字段的详细值）
  - 数据质量指示器

---

### "我的"页面详解

#### 1. 用户信息卡片

**显示内容**：
- **设备 ID**：设备的唯一标识符
- **用户类型**：
  - 0：未知用户
  - 1：新用户
  - 2：支持者
  - 3：赞助者（可使用高阶功能）
  - 4：铁粉（可使用高阶功能和数据页面）
- **车型信息**：车辆型号（如已填写）
- **微信名**：微信号或名称（如已填写）

**操作**：
- **点击"编辑"按钮**：
  - 打开编辑表单
  - 同时显示赞助二维码弹窗

---

#### 2. 使用统计卡片

**显示内容**：
- **使用次数**：应用启动的总次数
- **使用时长**：累计使用时间（小时）
- **累计距离**：使用应用期间累计行驶距离（公里）

---

#### 3. 用户信息编辑表单

**权限规则**：
- **用户类型 0 或 1**：可以编辑所有信息
  - 车型
  - 微信名
  - 赞助金额

- **用户类型 2 及以上**：只能编辑赞助金额
  - 车型和微信名已锁定，无法修改
  - 只能更新赞助金额

**操作**：
- **保存按钮**：保存修改的信息
- **取消按钮**：取消编辑，关闭表单和二维码弹窗

---

#### 4. 赞助二维码弹窗

**触发方式**：
- 点击"编辑"按钮时自动显示
- 也可以独立关闭（不影响编辑表单）

**显示内容**：
- 微信支付二维码（扫码支付）
- "扫码赞助"提示文字

**用途**：
- 用户可以通过扫码赞助项目
- 赞助后更新用户类型以获得更多功能

---

### "数据"页面详解（仅铁粉用户）

#### 1. 状态卡片区域

**第一行：基础状态**
- **导航状态**：显示"导航中"或"待机"
- **数据质量指示器**：
  - 🟢 绿色：数据质量良好
  - 🟡 黄色：数据质量警告
  - 🔴 红色：数据质量错误
- **道路信息**：
  - 道路类型（高速公路/国道等）
  - 道路类别代码
  - 车道数量（如可用）

**第二行：网络状态**
- **网络连接图标**：🌐
- **连接状态**：
  - ✅ 已连接
  - ❌ 未连接
- **交通灯状态指示器**：
  - 显示当前交通灯状态（红/绿/黄/无信号）
  - 显示倒计时（如可用）
- **调试信息**：
  - 高德地图 ICON 值和描述
  - TurnType 值和描述
  - 限速信息（SDI 限速/道路限速）
  - 已发送数据包数量

**操作按钮**：
- **刷新图标**：清空数据（重置统计）

---

#### 2. 实时数据表格

**显示内容**：
- **字段名称**：数据字段的标识符
- **描述**：字段的中文说明
- **实时值**：当前的数据值

**包含的数据类型**：
- GPS 位置数据（纬度、经度、方向角等）
- 导航数据（转弯、距离等）
- 限速数据（道路限速、SDI 限速等）
- 交通灯数据（状态、倒计时等）
- 系统状态数据（导航状态、激活状态等）

**用途**：
- 调试和排查问题
- 查看详细的数据传输状态
- 验证数据是否正确接收和处理

---

### "帮助"页面详解

#### 1. 常见问题（FAQ）

**内容**：
- 使用过程中的常见问题
- 详细的解答和解决方案

**操作**：
- **点击问题**：展开/折叠答案
- **默认状态**：折叠（节省空间）

---

#### 2. 视频教程

**内容**：
- 使用教程视频列表
- 视频标题和链接

**操作**：
- **点击视频**：在全屏浏览器中播放
- **视频来源**：从服务器获取视频列表

---

## 🚗 使用场景

### 场景 1：日常通勤导航
1. 打开高德地图，设置目的地，开始导航
2. 启动 CP搭子应用
3. 应用自动接收高德地图数据并发送给 Comma3
4. Comma3 自动调整速度，显示导航信息
5. 享受智能辅助驾驶体验

### 场景 2：长途高速驾驶
1. 在高速公路上使用高德地图导航
2. CP搭子实时传输：
   - 区间限速信息（高速路段常见）
   - 服务区位置
   - 收费站提醒
   - 隧道限速
3. Comma3 自动控制车速，避免超速

### 场景 3：城市复杂路况
1. 在城市道路中使用导航
2. CP搭子传输：
   - 红绿灯状态
   - 转弯导航
   - 学校区域限速
   - 各种摄像头提醒
3. Comma3 提前减速，安全通过复杂路口

---

## 💡 为什么选择 CP搭子？

### ✨ 唯一性
**CP搭子是目前唯一一款支持高德地图的 Comma3 导航桥接应用。**

其他应用可能支持：
- ❌ 仅支持 Google Maps（国内无法使用）
- ❌ 仅支持 Waze（国内数据不准确）
- ❌ 不支持中国地图服务

**只有 CP搭子支持：**
- ✅ 高德地图（中国用户最常用的导航应用）
- ✅ 完整的中国道路数据
- ✅ 实时准确的限速信息
- ✅ 区间测速支持

### 🎯 功能完整性
- ✅ **65 种摄像头类型支持**：覆盖所有常见交通监测设备
- ✅ **区间测速完整支持**：包括起点、中段、终点状态
- ✅ **交通灯状态支持**：红绿灯倒计时和状态
- ✅ **实时 GPS 同步**：高精度位置信息
- ✅ **自动设备发现**：无需手动配置

### 🔧 技术优势
- ✅ **自动数据转换**：无需了解技术细节，一键使用
- ✅ **智能错误恢复**：网络断线自动重连
- ✅ **低延迟传输**：200ms 更新频率，响应迅速
- ✅ **稳定可靠**：经过长期测试，稳定运行

---

## 📋 使用前准备

### 硬件要求
1. **Android 手机**：Android 8.0（API 26）或更高版本
2. **Comma3 设备**：已安装 CarrotPilot 系统的设备
3. **WiFi 网络**：手机和 Comma3 需要在同一 WiFi 网络下

### 软件要求
1. **高德地图**：需要安装并登录高德地图应用
2. **CP搭子应用**：下载并安装最新版本
3. **权限授予**：授予位置和网络权限

### 连接步骤
1. **启动高德地图**，开始导航
2. **打开 CP搭子应用**
3. **授予权限**（首次使用）
4. **等待连接**：应用会自动搜索并连接 Comma3 设备
5. **开始使用**：看到"已连接"状态即可

---

## 🛠️ 常见问题

### Q1: 应用显示"搜索设备中..."，一直连接不上？
**A:** 请检查：
- ✅ Comma3 设备是否已开机
- ✅ 手机和 Comma3 是否在同一 WiFi 网络
- ✅ Comma3 的 CarrotPilot 系统是否正常运行
- ✅ 防火墙是否阻止了端口 7705 和 7706

### Q2: 为什么收不到高德地图的数据？
**A:** 请检查：
- ✅ 高德地图是否正在导航（必须开始导航才会发送数据）
- ✅ 高德地图版本是否支持广播（建议使用最新版本）
- ✅ 手机系统是否允许应用在后台运行

### Q3: 区间限速不显示？
**A:** 
- ✅ 确认高德地图导航路线中有区间测速路段
- ✅ 高德地图需要完整版（某些简化版可能不发送区间测速数据）
- ✅ 检查应用是否正常连接到 Comma3

### Q4: GPS 坐标显示为 0？
**A:**
- ✅ 检查是否授予了位置权限
- ✅ 确认手机 GPS 功能已开启
- ✅ 在户外空旷地带测试（室内 GPS 信号弱）

### Q5: 应用在后台会自动停止？
**A:**
- ✅ 授予应用后台运行权限
- ✅ 在手机设置中将应用加入白名单（避免被杀后台）
- ✅ Android 10+ 需要授予后台位置权限

---

## 📊 技术规格

### 数据传输
- **协议**：UDP（用户数据报协议）
- **数据格式**：JSON（CarrotMan 协议）
- **发送频率**：200ms（约每秒 5 次）
- **数据包大小**：通常 < 2KB

### 支持的导航数据
- **GPS 位置**：实时更新
- **道路限速**：自动识别
- **摄像头信息**：65 种类型
- **转弯导航**：完整 TBT 数据
- **目的地信息**：自动同步
- **交通灯状态**：实时更新

### 兼容性
- **Android 版本**：8.0（API 26）及以上
- **高德地图版本**：支持标准广播接口的版本
- **Comma3 系统**：CarrotPilot 兼容系统

---

## 📚 附录：CarrotAmap 最终版说明

# 🚗 CarrotAmap - 辅助CarrotPilot的导航外挂小程序- 现阶段唯一利用高德地图导航的openpilot外挂

---

# C3 设备安装 CarrotAmap 高德地图教程

本教程将指导您在 Comma Three (C3) C3L 和PC版 设备上安装 CarrotAmap，实现基于高德地图的增强导航功能。

## 功能亮点
- 🚗 自动按导航变道和转弯
- 🗺️ 自动沿导航路线行驶
- 📊 根据限速自动调整车速
- 🚦 红灯自动减速停车
- 🛣️ 弯道自动减速
- ⚡ 保留所有 OpenPilot 原有功能
 
## CarrotAmap 最终版发布说明

CarrotAmap 迎来了最终版本的发布。

回顾这一路的探索，早在 2023 年 4 月换车买了 C2 后，我便踏上了折腾之路：从 dp 到 lp，再到 my，几乎都体验过，lp 给我留下了最好的印象。不到一年又升级到 C3，市面上的 sp、fp、op、dp 也都试了个遍。最终，我让 Mazda 成为全球首个支持 CLSC 的车型，配合内置导航 NOO，效果令人惊艳。

后来，我深入研究了加拿大魔改版 fp，彻底理解了 TI、RI 的运行机制。正因如此，我果断停用了它——毕竟风险不可控。之后发现，内置地图存在诸多问题：道路缺失、限速信息滞后等。

又过了一年，偶然遇见了 cp。坦白说，最初是被酷炫的 UI 吸引，成为全球首个在 Mazda 上使用 cp 的“小白鼠”。自此，我开始深入研究 cp，从简单汉化到逆向 carrotman 的代码，再到反编译其安卓 apk。几个月断断续续的折腾后，终于实现了最初的设想：将高德导航数据传递给 cp，实现 ATC！

其实，最初我还想做得更极致——在 app 界面模拟 NOA 效果，通过广播将数据发送到手机端，再结合车道信息计算当前所在车道。技术上完全可行，但精力有限、用户反馈稀少，最终还是回归初心，专注于最实用的数据传输功能。

有趣的是，国内用户几乎没有反馈，反倒是国外有人主动联系，甚至愿意付美金让我开发美版外挂导航，把数据发送给 cp。我也研究了 sdk 和 api，确认可行。如果有小伙伴有兴趣接手，欢迎联系我。

至于为什么之前一直是内测版，这次却是“最终版”？
因为现在我已不再是上班族，更多时间和精力需要留给家人和生活。现阶段的 CarrotAmap 已经达到了我最满意的状态：

- 一键导航
- 自动连接并发送数据到 cp
- 一键配置参数
- 动态切换 CLSC / MRCC / OPCS 模式
- 支持发送目的地到 cp
- 完全基于高德导航数据进行 ATC

在 CarrotAmap 的加持下，cp 的表现有了极大提升。

如果你希望让 app 变得更好，欢迎沿着我验证过的技术路线继续探索，这条路完全行得通！

最后，如果你觉得体验不错，请推荐给身边的朋友，让更多人感受它的魅力；如果体验不理想，也请多多包容——毕竟是个人开发，难免不够完善，你仍可以选择回到 sp、dp 或 fp。

—— CarrotAmap 开发者
2025-08-18

![](/demo.jpg "app")

---

## 🎉 总结

CP搭子是一款**专为中国用户设计**的 Comma3 导航桥接应用，通过接收高德地图的实时导航数据并发送给 Comma3 设备，让您的智能驾驶体验更加完整和安全。

**核心优势：**
- 🌟 **唯一支持高德地图**的 Comma3 桥接应用
- 🚀 **实时数据传输**，低延迟响应
- 📍 **完整导航功能**，包括区间限速、摄像头提醒等
- 🔧 **自动设备发现**，无需手动配置
- 💪 **稳定可靠**，长期使用验证

无论您是日常通勤还是长途驾驶，CP搭子都能让您的 Comma3 设备获得最准确、最全面的导航数据支持，实现真正的智能辅助驾驶。

---

**版本信息：** v251030  
**最后更新：** 2025年

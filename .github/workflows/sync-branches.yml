name: Sync Branches

on:
  schedule:
    - cron: '0 18 * * *'    # 每天 UTC 18 点
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout the target repository (your repo)
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          token: ${{ secrets.GH_TOKEN }}

      - name: Add upstream repositories and fetch branches
        run: |
          set -e
          echo "Fetching branches from upstream repositories..."

          # ajouatom branches
          git remote add ajouatom https://github.com/ajouatom/openpilot.git
          git fetch ajouatom carrot2-v9 --no-tags || echo "⚠️ ajouatom carrot2-v9 fetch failed"
          
          # sunnypilot branch
          git remote add sunnypilot https://github.com/sunnypilot/sunnypilot.git
          git fetch sunnypilot staging --no-tags || echo "⚠️ sunnypilot staging fetch failed"
          
          # dragonpilot branch
          git remote add dragonpilot https://github.com/dragonpilot/dragonpilot.git
          git fetch dragonpilot pre-build --no-tags || echo "⚠️ dragonpilot pre-build fetch failed"

      - name: Push branches to your repository
        run: |
          set +e

          # ajouatom carrot2-v9
          git checkout -B carrot2-v9 ajouatom/carrot2-v9 \
            && git push origin carrot2-v9 --force \
            || echo "⚠️ carrot2-v9 push skipped"
          
          # sunnypilot staging
          git checkout -B sunnypilot-staging sunnypilot/staging \
            && git push origin sunnypilot-staging --force \
            || echo "⚠️ sunnypilot-staging push skipped"
          
          # dragonpilot pre-build
          git checkout -B dragonpilot-pre-build dragonpilot/pre-build \
            && git push origin dragonpilot-pre-build --force \
            || echo "⚠️ dragonpilot-pre-build push skipped"

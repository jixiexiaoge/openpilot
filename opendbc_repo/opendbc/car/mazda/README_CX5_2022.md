# Mazda CX5 2022 优化版实验模式和CSLC功能

本文档介绍了为 Mazda CX5 2022 特别优化的 openpilot 实验模式和 CSLC (Cruise Speed Limit Control) 功能。

## 特点和优化

我们对 Mazda CX5 2022 进行了一系列专门优化，使其成为 openpilot 支持的最佳马自达车型：

### 1. 转向控制优化

- **降低转向延迟**：`steerActuatorDelay` 从 0.1 降至 0.075，提供更快的转向响应
- **平滑转向释放**：`steerLimitTimer` 从 0.8 增至 0.85，减少转向释放时的突然感
- **优化转向比**：调整为 15.3，提供更精确的转向控制
- **增强转向响应速度**：提高 `STEER_DELTA_UP`，使转向更敏捷

### 2. 纵向控制优化

- **平滑加速控制**：使用优化的 PI 控制器参数，提供更自然的加速体验
- **改进停车体验**：调整 `stoppingDecelRate` 为 4.0，实现更舒适的停车过程
- **优化启动性能**：增加 `stopAccel` 和 `vEgoStarting` 参数，提供更流畅的起步

### 3. CSLC 功能增强

- **更低的最小速度设置**：CX5 2022 可以设置 25 km/h 的最小巡航速度
- **速度滤波器**：实现动态调整的速度滤波器，提供平滑的速度变化
- **智能按钮控制**：根据 CX5 2022 的特性优化按钮发送频率和阈值
- **自动恢复巡航**：优化停车后恢复巡航的逻辑，提高 Stop & Go 性能

## 使用方法

### 开启实验模式

1. 在 openpilot 界面进入设置
2. 切换到开发者页面
3. 开启"实验模式"
4. 重启 openpilot

### CSLC 功能使用

CSLC (Cruise Speed Limit Control) 会在实验模式开启时自动启用，它能够：

1. 通过模拟按下巡航控制按钮来精确控制车速
2. 自动调整到设定的目标速度
3. 提供更精确的跟车和自适应巡航功能

### 特别提示

- CX5 2022 在实验模式下已经过优化，适合日常使用
- 系统会自动处理停车和启动情况，无需额外操作
- 在低速和停止情况下，系统能够自动发送 RESUME 信号继续行驶

## 技术细节

1. **实验模式与 CSLC 集成**
   - 实验模式开启会自动启用 CSLC
   - CSLC 可以单独使用，不依赖实验模式

2. **车辆特定参数**
   ```python
   # CX5 2022 特有参数
   ret.longitudinalTuning.kpBP = [0., 5., 30.]
   ret.longitudinalTuning.kpV = [1.2, 1.0, 0.7]
   ret.longitudinalTuning.kiBP = [0., 5., 20., 30.]
   ret.longitudinalTuning.kiV = [0.3, 0.2, 0.15, 0.1]
   ```

3. **性能调整**
   - 按钮发送频率：每隔 8 帧发送一次（比普通马自达更快）
   - 速度调整阈值：5 km/h × 1.2 = 6 km/h（考虑 CX5 2022 的特性）

## 常见问题

1. **实验模式无法开启？**
   - 确保 `CSLCEnabled` 参数已设置，可通过 SSH 执行 `echo -n "1" > /data/params/d/CSLCEnabled`

2. **车速控制不精确？**
   - CX5 2022 的速度控制是通过模拟按键实现的，有一定的延迟
   - 系统已经过优化，但仍有可能出现轻微波动

3. **停车后无法自动启动？**
   - 确保开启了实验模式
   - 系统会自动发送 RESUME 命令，但可能需要轻踩油门辅助

## 后续开发计划

我们将继续优化 CX5 2022 的体验，计划包括：

1. 进一步改进低速控制精度
2. 增强停车和启动的平顺性
3. 优化与前车的跟车逻辑

感谢您使用我们为 Mazda CX5 2022 特别优化的实验模式和 CSLC 功能。如有问题或建议，请通过社区渠道反馈。
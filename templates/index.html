<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>comma3 å®æ—¶è½¦é“çº¿æ£€æµ‹</title>  
    <style>  
        * {  
            margin: 0;  
            padding: 0;  
            box-sizing: border-box;  
        }  
          
        body {  
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);  
            min-height: 100vh;  
            padding: 20px;  
        }  
          
        .header {  
            text-align: center;  
            color: white;  
            margin-bottom: 30px;  
        }  
          
        .header h1 {  
            font-size: 2.5rem;  
            margin-bottom: 10px;  
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);  
        }  
          
        .header p {  
            font-size: 1.1rem;  
            opacity: 0.9;  
        }  
          
        .container {  
            max-width: 1400px;  
            margin: 0 auto;  
            display: flex;  
            gap: 30px;  
            flex-wrap: wrap;  
        }  
          
        .video-section {  
            flex: 1;  
            min-width: 600px;  
        }  
          
        .data-section {  
            width: 350px;  
            background: rgba(255, 255, 255, 0.95);  
            border-radius: 15px;  
            padding: 25px;  
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);  
            backdrop-filter: blur(10px);  
        }  
          
        .video-container {  
            background: #000;  
            border-radius: 15px;  
            overflow: hidden;  
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);  
            position: relative;  
        }  
          
        .video-container img {  
            width: 100%;  
            height: auto;  
            display: block;  
        }  
          
        .video-overlay {  
            position: absolute;  
            top: 20px;  
            left: 20px;  
            color: white;  
            font-size: 14px;  
            background: rgba(0,0,0,0.6);  
            padding: 8px 12px;  
            border-radius: 5px;  
        }  
          
        .data-section h3 {  
            color: #333;  
            margin-bottom: 20px;  
            font-size: 1.3rem;  
            border-bottom: 2px solid #667eea;  
            padding-bottom: 10px;  
        }  
          
        .data-item {  
            margin: 15px 0;  
            padding: 15px;  
            background: #f8f9fa;  
            border-radius: 10px;  
            border-left: 4px solid #667eea;  
            transition: transform 0.2s, box-shadow 0.2s;  
        }  
          
        .data-item:hover {  
            transform: translateY(-2px);  
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);  
        }  
          
        .data-item strong {  
            color: #333;  
            display: block;  
            margin-bottom: 5px;  
            font-size: 0.9rem;  
        }  
          
        .data-item span {  
            color: #667eea;  
            font-weight: bold;  
            font-size: 1.1rem;  
        }  
          
        .status-indicator {  
            display: inline-block;  
            width: 12px;  
            height: 12px;  
            border-radius: 50%;  
            margin-right: 8px;  
            animation: pulse 2s infinite;  
        }  
          
        .status-online {  
            background-color: #28a745;  
        }  
          
        .status-offline {  
            background-color: #dc3545;  
        }  
          
        @keyframes pulse {  
            0% { opacity: 1; }  
            50% { opacity: 0.5; }  
            100% { opacity: 1; }  
        }  
          
        .refresh-btn {  
            background: #667eea;  
            color: white;  
            border: none;  
            padding: 10px 20px;  
            border-radius: 5px;  
            cursor: pointer;  
            margin-top: 20px;  
            width: 100%;  
            font-size: 1rem;  
            transition: background 0.3s;  
        }  
          
        .refresh-btn:hover {  
            background: #5a6fd8;  
        }  
          
        @media (max-width: 1024px) {  
            .container {  
                flex-direction: column;  
                align-items: center;  
            }  
              
            .video-section, .data-section {  
                width: 100%;  
                max-width: 800px;  
            }  
        }  
    </style>  
</head>  
<body>  
    <div class="header">  
        <h1>ğŸš— comma3 å®æ—¶è½¦é“çº¿æ£€æµ‹</h1>  
        <p>åŸºäºä¼ ç»Ÿè®¡ç®—æœºè§†è§‰ç®—æ³•çš„è½¦é“çº¿è¯†åˆ«ç³»ç»Ÿ</p>  
    </div>  
      
    <div class="container">  
        <div class="video-section">  
            <div class="video-container">  
                <img src="/video_feed" alt="è½¦é“çº¿æ£€æµ‹è§†é¢‘æµ" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQ1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuaVsOWtl+Wtl+ivleaWh+aho+WKoOi9veWksei0pTwvdGV4dD4KPC9zdmc+';">  
                <div class="video-overlay">  
                    <span class="status-indicator status-online"></span>  
                    å®æ—¶æ£€æµ‹ä¸­  
                </div>  
            </div>  
        </div>  
          
        <div class="data-section">  
            <h3>ğŸ“Š æ£€æµ‹æ•°æ®</h3>  
              
            <div class="data-item">  
                <strong>å·¦è½¦é“çº¿ç±»å‹</strong>  
                <span id="left_type">Unknown</span>  
            </div>  
              
            <div class="data-item">  
                <strong>å³è½¦é“çº¿ç±»å‹</strong>  
                <span id="right_type">Unknown</span>  
            </div>  
              
            <div class="data-item">  
                <strong>é“è·¯æ›²ç‡åŠå¾„</strong>  
                <span id="curvature">0.0</span> m  
            </div>  
              
            <div class="data-item">  
                <strong>è½¦è¾†åç¦»è·ç¦»</strong>  
                <span id="departure">0.0</span> m  
            </div>  
              
            <div class="data-item">  
                <strong>æ›´æ–°æ—¶é—´</strong>  
                <span id="update_time">--:--:--</span>  
            </div>  
              
            <button class="refresh-btn" onclick="updateMetadata()">ğŸ”„ æ‰‹åŠ¨åˆ·æ–°</button>  
        </div>  
    </div>  
  
    <script>  
        let updateCount = 0;  
        let errorCount = 0;  
          
        function formatTime() {  
            const now = new Date();  
            return now.toLocaleTimeString('zh-CN');  
        }  
          
        function updateMetadata() {  
            fetch('/metadata')  
                .then(response => {  
                    if (!response.ok) {  
                        throw new Error(`HTTP error! status: ${response.status}`);  
                    }  
                    return response.json();  
                })  
                .then(data => {  
                    // æ›´æ–°è½¦é“çº¿ç±»å‹  
                    document.getElementById('left_type').textContent = data.left_type || 'Unknown';  
                    document.getElementById('right_type').textContent = data.right_type || 'Unknown';  
                      
                    // æ›´æ–°æ•°å€¼æ•°æ®  
                    document.getElementById('curvature').textContent =   
                        (data.curvature || 0).toFixed(2);  
                    document.getElementById('departure').textContent =   
                        (data.departure || 0).toFixed(2);  
                      
                    // æ›´æ–°æ—¶é—´  
                    document.getElementById('update_time').textContent = formatTime();  
                      
                    // é‡ç½®é”™è¯¯è®¡æ•°  
                    errorCount = 0;  
                    updateCount++;  
                      
                    // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨  
                    const indicator = document.querySelector('.status-indicator');  
                    indicator.className = 'status-indicator status-online';  
                      
                    console.log(`æ•°æ®æ›´æ–°æˆåŠŸ (${updateCount}æ¬¡)`);  
                })  
                .catch(error => {  
                    errorCount++;  
                    console.error(`æ•°æ®æ›´æ–°å¤±è´¥ (${errorCount}æ¬¡):`, error);  
                      
                    // è¿ç»­å¤±è´¥3æ¬¡åæ˜¾ç¤ºç¦»çº¿çŠ¶æ€  
                    if (errorCount >= 3) {  
                        const indicator = document.querySelector('.status-indicator');  
                        indicator.className = 'status-indicator status-offline';  
                        document.querySelector('.video-overlay').innerHTML =   
                            '<span class="status-indicator status-offline"></span>è¿æ¥æ–­å¼€';  
                    }  
                });  
        }  
          
        // é¡µé¢åŠ è½½æ—¶ç«‹å³æ›´æ–°ä¸€æ¬¡  
        updateMetadata();  
          
        // æ¯ç§’è‡ªåŠ¨æ›´æ–°æ•°æ®  
        setInterval(updateMetadata, 1000);  
          
        // ç›‘å¬è§†é¢‘æµçŠ¶æ€  
        const videoImg = document.querySelector('img[src="/video_feed"]');  
        videoImg.addEventListener('load', function() {  
            console.log('è§†é¢‘æµè¿æ¥æ­£å¸¸');  
        });  
          
        videoImg.addEventListener('error', function() {  
            console.error('è§†é¢‘æµè¿æ¥å¤±è´¥');  
            const indicator = document.querySelector('.status-indicator');  
            indicator.className = 'status-indicator status-offline';  
        });  
          
        // æ·»åŠ é”®ç›˜å¿«æ·é”®  
        document.addEventListener('keydown', function(event) {  
            if (event.key === 'r' || event.key === 'R') {  
                updateMetadata();  
            }  
        });  
    </script>  
</body>  
</html>